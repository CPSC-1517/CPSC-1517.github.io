(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{159:function(e,t,r){e.exports=r.p+"assets/img/65a79bacad56128241e52332894cdcf0.65a79bac.png"},259:function(e,t,r){"use strict";r.r(t);var o=[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"content"},[o("p",[o("strong",[e._v("Objectives:")])]),o("p",[o("strong",[e._v("Discuss:")])]),o("blockquote",[o("p",[e._v("Review Form Validation?")])]),o("blockquote",[o("p",[e._v("Review CRUD concepts: Add, Update and Delete.")])]),o("blockquote",[o("p",[e._v("Discuss different Deletes (physical vs logical).")])]),o("p",[o("strong",[e._v("Code:")])]),o("blockquote",[o("p",[e._v("Review Validation controls.")])]),o("blockquote",[o("p",[e._v("BLL: Insert, Update and Delete routines")])]),o("blockquote",[o("p",[e._v("WebPage: Insert, Update and Delete events.")])]),o("p",[o("strong",[e._v("Resources: Student")])]),o("p",[e._v("Moodle site.")]),o("p",[e._v("URL Student Notes")]),o("p",[o("strong",[e._v("Resources: Instructor")])]),o("p",[e._v("Lesson 2: CRUD using EnityFramework for database access.")]),o("p",[o("strong",[e._v("Concepts:")])]),o("ol",[o("li",[o("p",[e._v("Quick review EntityFramework: entity definition: Validation annotations"),o("br"),e._v("\nRequired,StringLength")])]),o("li",[o("p",[e._v("Quick review of Validation Controls.")])]),o("li",[o("p",[e._v("BLL controller classes:")]),o("ul",[o("li",[o("p",[e._v("Insert.")])]),o("li",[o("p",[e._v("Update.")])]),o("li",[o("p",[e._v("Delete (physical and logical, code both, comment out one of them)")])])])]),o("li",[o("p",[e._v("Queries using EntityFramework")]),o("ul",[o("li",[o("p",[e._v("List All table records")])]),o("li",[o("p",[e._v("Primary Key query")])])])])]),o("p",[o("strong",[e._v("Validation: Form, Entity, and SQL")])]),o("p",[e._v("Data entering the system should be validated. This can occur in one or more"),o("br"),e._v("\nplaces. Validation controls on the web page can check data on the client side"),o("br"),e._v("\nand on the server side. Logical checks can be on the server side. Logical checks"),o("br"),e._v("\ncan be done in the BLL (Business Logic Layer) method. Constraints and checks can"),o("br"),e._v("\nbe set up in your database table/procedure/triggers. One other place validation"),o("br"),e._v("\ncan be done is in the mapping entity used by EntityFramework. Several"),o("br"),e._v("\nannotations exist for validating. We have looked at two Required and"),o("br"),e._v("\nStringLength.")]),o("p",[e._v("Code:")]),o("p",[e._v("Entity Definition Annotation:")]),o("p",[e._v('[Required(ErrorMessage ="Product Name is required.")]')]),o("p",[e._v('[StringLength(40,ErrorMessage ="Product Name is limited to 40 Characters.")]')]),o("p",[e._v("public string ProductName { get; set; }")]),o("p",[e._v('[StringLength(20, ErrorMessage = "Quantity per Unit is limited to 20'),o("br"),e._v('\nCharacters.")]')]),o("p",[e._v("public string QuantityPerUnit { get; set; }")]),o("p",[e._v("(For demonstration purposes, you may wish to limit the length to 10. Once you"),o("br"),e._v("\nhave demonstrated the validation works, change the values back to their proper"),o("br"),e._v("\nlength).")]),o("p",[e._v("Web Page Validation (for demonstration purposes you could use Required and one"),o("br"),e._v("\nCompare validator)")]),o("p",[e._v("<br />")]),o("p",[e._v('<asp:RequiredFieldValidator ID="RequiredFieldProductName" runat="server"')]),o("p",[e._v('ErrorMessage="Product Name is required." Display="None"')]),o("p",[e._v('SetFocusOnError="true" ForeColor="#990000" ControlToValidate="ProductName">')]),o("p",[e._v("</asp:RequiredFieldValidator>")]),o("p",[e._v('<asp:CompareValidator ID="CompareUnitPrice" runat="server"')]),o("p",[e._v('ErrorMessage="Unit Price is a value greater or equal to 0.00" Display="None"')]),o("p",[e._v('SetFocusOnError="true" ForeColor="#990000" Type="Double"')]),o("p",[e._v('ControlToValidate="UnitPrice" Operator="GreaterThanEqual"'),o("br"),e._v('\nValueToCompare="0.00">')]),o("p",[e._v("</asp:CompareValidator>")]),o("p",[e._v('<asp:CompareValidator ID="CompareUnitsInStock" runat="server"')]),o("p",[e._v('ErrorMessage="Units in Stock is a value greater or equal to 0" Display="None"')]),o("p",[e._v('SetFocusOnError="true" ForeColor="#990000" Type="Integer"')]),o("p",[e._v('ControlToValidate="UnitsInStock" Operator="GreaterThanEqual"'),o("br"),e._v('\nValueToCompare="0">')]),o("p",[e._v("</asp:CompareValidator>")]),o("p",[e._v('<asp:CompareValidator ID="CompareUnitsOnOrder" runat="server"')]),o("p",[e._v('ErrorMessage="Units on Order is a value greater or equal to 0" Display="None"')]),o("p",[e._v('SetFocusOnError="true" ForeColor="#990000" Type="Integer"')]),o("p",[e._v('ControlToValidate="UnitsOnOrder" Operator="GreaterThanEqual"'),o("br"),e._v('\nValueToCompare="0">')]),o("p",[e._v("</asp:CompareValidator>")]),o("p",[e._v('<asp:CompareValidator ID="CompareReorderLevel" runat="server"')]),o("p",[e._v('ErrorMessage="Reorder Level is a value greater or equal to 0" Display="None"')]),o("p",[e._v('SetFocusOnError="true" ForeColor="#990000" Type="Integer"')]),o("p",[e._v('ControlToValidate="ReorderLevel" Operator="GreaterThanEqual"'),o("br"),e._v('\nValueToCompare="0">')]),o("p",[e._v("</asp:CompareValidator>")]),o("p",[e._v('<asp:ValidationSummary ID="ValidationSummary1" runat="server"')]),o("p",[e._v('HeaderText="Resolve the follow data errors:" CssClass="alert alert-danger" />')]),o("p",[e._v("Event Code:")]),o("p",[e._v("protected void AddProduct_Click(object sender, EventArgs e)")]),o("p",[e._v("{")]),o("p",[e._v("if (Page.IsValid)")]),o("p",[e._v("{")]),o("p",[e._v("//verify a Supplier was selected for lookup")]),o("p",[e._v("if (SupplierList.SelectedIndex == 0)")]),o("p",[e._v("{")]),o("p",[e._v('Message.Text = "Please select a supplier for the product";')]),o("p",[e._v("}")]),o("p",[e._v("else if (CategoryList.SelectedIndex == 0)")]),o("p",[e._v("{")]),o("p",[e._v('Message.Text = "Please select a category for the product";')]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("blockquote",[o("p",[e._v("{")])]),o("blockquote",[o("p",[e._v("//CRUD code goes here")])]),o("p",[e._v("}")]),o("blockquote",[o("p",[e._v("}")])]),o("p",[e._v("}")]),o("p",[e._v("SQL Attribute:")]),o("p",[e._v("ProductName nvarchar(40) not null")]),o("p",[e._v("QuantityPerUnit nvarchar(20) null")]),o("p",[o("strong",[e._v("EntityFramework: BLL methods")])]),o("p",[e._v("EntityFramework simplifies access to your database. EntityFramework will manage"),o("br"),e._v("\nthe access of data to and from the database (aqua color). The DAL layer will"),o("br"),e._v("\ncontain a class which will be referred to as the Context class. This class will"),o("br"),e._v("\ninherit DbContext from EntityFramework. The commands to query, add, update and"),o("br"),e._v("\ndelete records will be coded in the BLL classes using the DAL Context Class. The"),o("br"),e._v("\nmapping of the sql tables will be done in the Entity classes of the Entity"),o("br"),e._v("\nlibrary. These entity classes will be used by the DAL, BLL and PL layers. These"),o("br"),e._v("\nclasses are data definitions of the sql tables.")]),o("p",[o("img",{attrs:{src:r(159),alt:""}})]),o("p",[o("strong",[e._v("Coding: Create BLL CRUD methods")])]),o("p",[e._v("Interface methods are needed within the BLL controller to add, update and delete"),o("br"),e._v("\nrows to/from sql tables via your DbContext class DbSet<T> properties. One nice"),o("br"),e._v("\nthing about EFW is it likes to work at the entity level. This is convenient for"),o("br"),e._v("\nus as we are inserting whole new rows, updating whole rows or deleting whole"),o("br"),e._v("\nrows to/from our database.")]),o("p",[e._v("Insert")]),o("p",[e._v("public int Product_Add(Product item)")]),o("p",[e._v("{")]),o("p",[e._v("//start the insert transaction")]),o("p",[e._v("using (var context = new NorthwindContext())")]),o("p",[e._v("{")]),o("p",[e._v("//stage new record to DbSet<T> for commitment to database")]),o("p",[e._v("context.Products.Add(item);")]),o("p",[e._v("//commit new record to the database")]),o("p",[e._v("//if this statement is not executed, insert is not")]),o("p",[e._v("// completed in database (RollBack)")]),o("p",[e._v("//new identity value is create on successful execution of")]),o("p",[e._v("// this command, it is not created or available until")]),o("p",[e._v("// this command completes")]),o("p",[e._v("//during this command execution, any entity validation annotation")]),o("p",[e._v("// is executed")]),o("p",[e._v("context.SaveChanges();")]),o("p",[e._v("//at this point, successful execution of SaveChanges() has occurred")]),o("p",[e._v("//row has been committed to the database")]),o("p",[e._v("//the new identity value is now available")]),o("p",[e._v("//return the new identity value")]),o("p",[e._v("return item.ProductID;")]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("Update")]),o("p",[e._v("public int Product_Update(Product item)")]),o("p",[e._v("{")]),o("p",[e._v("//start the insert transaction")]),o("p",[e._v("using (var context = new NorthwindContext())")]),o("p",[e._v("{")]),o("p",[e._v("//stage record to DbSet<T> for commitment to database")]),o("p",[e._v("context.Entry(item).State = System.Data.Entity.EntityState.Modified;")]),o("p",[e._v("//commit new record to the database")]),o("p",[e._v("//if this statement is not executed, update is not")]),o("p",[e._v("// completed in database (RollBack)")]),o("p",[e._v("//during this command execution, any entity validation annotation")]),o("p",[e._v("// is executed")]),o("p",[e._v("//the number of database rows affected is the return value")]),o("p",[e._v("return context.SaveChanges();")]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("Delete (physical vs logical: use one or the other)")]),o("p",[e._v("public int Product_Delete(int productid)")]),o("p",[e._v("{")]),o("p",[e._v("//start the insert transaction")]),o("p",[e._v("using (var context = new NorthwindContext())")]),o("p",[e._v("{")]),o("p",[e._v("//physical delete")]),o("p",[e._v("//find the existing record on the database that matches")]),o("p",[e._v("// the supplied primary key value")]),o("p",[e._v("var existing = context.Products.Find(productid);")]),o("p",[e._v("//stage record of the DbSet<T> for removal from the database")]),o("p",[e._v("context.Products.Remove(existing);")]),o("p",[e._v("//commit record removal from the database")]),o("p",[e._v("//if this statement is not executed, delete is not")]),o("p",[e._v("// completed in database (RollBack)")]),o("p",[e._v("//the number of database rows affected is the return value")]),o("p",[e._v("return context.SaveChanges();")]),o("p",[e._v("//logical delete")]),o("p",[e._v("//find the existing record on the database that matches")]),o("p",[e._v("// the supplied primary key value")]),o("p",[e._v("var existing = context.Products.Find(productid);")]),o("p",[e._v("//alter the appropriate field on the record which will")]),o("p",[e._v("// apply the logic delete")]),o("p",[e._v("existing.Discontinued = true;")]),o("p",[e._v("//stage record of the DbSet<T> for update to the database")]),o("p",[e._v("context.Entry(existing).State = System.Data.Entity.EntityState.Modified;")]),o("p",[e._v("//commit record update to the database")]),o("p",[e._v("//if this statement is not executed, delete is not")]),o("p",[e._v("// completed in database (RollBack)")]),o("p",[e._v("//the number of database rows affected is the return value")]),o("p",[e._v("return context.SaveChanges();")]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("The Delete method can either be physical or logical. In the physical delete, you"),o("br"),e._v("\nwill use the .Remove(entity) method of the DbSet<T> property. For the logical"),o("br"),e._v("\ndelete, you will actually do an update. Naturally, only one or the other is"),o("br"),e._v("\nused.")]),o("p",[e._v("Since there will be validation controls on the web form, some buttons will need"),o("br"),e._v('\nto suppress validation. Add the property CausesValidation="false" to any button'),o("br"),e._v("\nwhich should have validation suppressed.")]),o("p",[o("strong",[e._v("Coding: Create WebPage CRUD methods")]),e._v(":")]),o("p",[e._v("Implement the AddProduct event. Double click the Add linkbutton on the Design"),o("br"),e._v("\nview.")]),o("p",[e._v("protected void AddProduct_Click(object sender, EventArgs e)")]),o("p",[e._v("{")]),o("p",[e._v("if (Page.IsValid)")]),o("p",[e._v("{")]),o("p",[e._v("//verify a Supplier was selected for lookup")]),o("p",[e._v("if (SupplierList.SelectedIndex == 0)")]),o("p",[e._v("{")]),o("p",[e._v('errormsgs.Add("Please select a supplier for the product");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-info");')]),o("p",[e._v("}")]),o("p",[e._v("else if (CategoryList.SelectedIndex == 0)")]),o("p",[e._v("{")]),o("p",[e._v('errormsgs.Add("Please select a category for the product");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-info");')]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("try")]),o("p",[e._v("{")]),o("p",[e._v("//connect to the required controller")]),o("p",[e._v("ProductController sysmgr = new ProductController();")]),o("p",[e._v("//create an instance for the data being collected")]),o("p",[e._v("Product newProduct = new Product();")]),o("p",[e._v("//load the instance with the data on the web form")]),o("p",[e._v("newProduct.ProductName= ProductName.Text ;")]),o("p",[e._v("newProduct.SupplierID = int.Parse(SupplierList.SelectedValue);")]),o("p",[e._v("newProduct.CategoryID = int.Parse(CategoryList.SelectedValue);")]),o("p",[e._v("newProduct.QuantityPerUnit ="),o("br"),e._v("\nstring.IsNullOrEmpty(QuantityPerUnit.Text)? null:"),o("br"),e._v("\nQuantityPerUnit.Text;")]),o("p",[e._v("if (string.IsNullOrEmpty(UnitPrice.Text))")]),o("p",[e._v("{")]),o("p",[e._v("newProduct.UnitPrice = null;")]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("newProduct.UnitPrice = decimal.Parse(UnitPrice.Text);")]),o("p",[e._v("}")]),o("p",[e._v("if (string.IsNullOrEmpty(UnitsInStock.Text))")]),o("p",[e._v("{")]),o("p",[e._v("newProduct.UnitsInStock = null;")]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("newProduct.UnitsInStock = short.Parse(UnitsInStock.Text);")]),o("p",[e._v("}")]),o("p",[e._v("if (string.IsNullOrEmpty(UnitsOnOrder.Text))")]),o("p",[e._v("{")]),o("p",[e._v("newProduct.UnitsOnOrder = null;")]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("newProduct.UnitsOnOrder = short.Parse(UnitsOnOrder.Text);")]),o("p",[e._v("}")]),o("p",[e._v("if (string.IsNullOrEmpty(ReorderLevel.Text))")]),o("p",[e._v("{")]),o("p",[e._v("newProduct.ReorderLevel = null;")]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("newProduct.ReorderLevel = short.Parse(ReorderLevel.Text);")]),o("p",[e._v("}")]),o("p",[e._v("newProduct.Discontinued = Discontinued.Checked;")]),o("p",[e._v("//make your call and capture the new identity productid")]),o("p",[e._v("int newProductID = sysmgr.Product_Add(newProduct);")]),o("p",[e._v("//load the ProductID label control")]),o("p",[e._v("ProductID.Text = newProductID.ToString();")]),o("p",[e._v("//Refresh the dropdownlist to reflect the added record")]),o("p",[e._v("BindProductList();")]),o("p",[e._v("ProductList.SelectedValue = ProductID.Text;")]),o("p",[e._v("//communicate to the user")]),o("p",[e._v('errormsgs.Add("Product has been added to database.");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-success");')]),o("p",[e._v("}")]),o("blockquote",[o("p",[e._v("catch (DbUpdateException ex)")])]),o("p",[e._v("{")]),o("p",[e._v("UpdateException updateException ="),o("br"),e._v("\n(UpdateException)ex.InnerException;")]),o("p",[e._v("if (updateException.InnerException != null)")]),o("p",[e._v("{")]),o("blockquote",[o("p",[e._v("errormsgs.Add(updateException.InnerException.Message.ToString());")])]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("errormsgs.Add(updateException.Message);")]),o("p",[e._v("}")]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-danger");')]),o("p",[e._v("}")]),o("p",[e._v("catch (DbEntityValidationException ex)")]),o("p",[e._v("{")]),o("p",[e._v("foreach (var entityValidationErrors in ex.EntityValidationErrors)")]),o("p",[e._v("{")]),o("p",[e._v("foreach (var validationError in"),o("br"),e._v("\nentityValidationErrors.ValidationErrors)")]),o("p",[e._v("{")]),o("p",[e._v('errormsgs.Add("Error: " + validationError.ErrorMessage);')]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-danger");')]),o("p",[e._v("}")]),o("p",[e._v("catch (Exception ex)")]),o("p",[e._v("{")]),o("p",[e._v("errormsgs.Add(GetInnerException(ex).ToString());")]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-danger");')]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("Implement the UpdateProduct event. Double click the Update linkbutton on the"),o("br"),e._v("\nDesign view. This method will be very similar to the Add. The differences are a)"),o("br"),e._v("\ncheck for ProductID, b) load the ProductID with the rest of the data from the"),o("br"),e._v("\nweb controls, and c) the Update call returns the number of rows affected. Test"),o("br"),e._v("\nthe number of rows affected to ensure a records was actually updated. Remember,"),o("br"),e._v("\nthis is a multi-user environment which means another user could have removed the"),o("br"),e._v("\ncurrently editing record from the database between the Search and the Update.")]),o("p",[e._v("protected void UpdateProduct_Click(object sender, EventArgs e)")]),o("p",[e._v("{")]),o("p",[e._v("if (Page.IsValid)")]),o("p",[e._v("{")]),o("p",[e._v("if (string.IsNullOrEmpty(ProductID.Text))")]),o("p",[e._v("{")]),o("p",[e._v('errormsgs.Add("Please select a product to update. Select and Search.");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-info");')]),o("p",[e._v("}")]),o("p",[e._v("//verify a Supplier was selected for lookup")]),o("p",[e._v("else if (SupplierList.SelectedIndex == 0)")]),o("p",[e._v("{")]),o("p",[e._v('errormsgs.Add("Please select a supplier for the product");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-info");')]),o("p",[e._v("}")]),o("p",[e._v("else if (CategoryList.SelectedIndex == 0)")]),o("p",[e._v("{")]),o("p",[e._v('errormsgs.Add("Please select a category for the product");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-info");')]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("try")]),o("p",[e._v("{")]),o("p",[e._v("//connect to the required controller")]),o("p",[e._v("ProductController sysmgr = new ProductController();")]),o("p",[e._v("//create an instance for the data being collected")]),o("p",[e._v("Product theProduct = new Product();")]),o("p",[e._v("//load the instance with the data on the web form")]),o("p",[e._v("theProduct.ProductID = int.Parse(ProductID.Text);")]),o("p",[e._v("theProduct.ProductName = ProductName.Text;")]),o("p",[e._v("theProduct.SupplierID = int.Parse(SupplierList.SelectedValue);")]),o("p",[e._v("theProduct.CategoryID = int.Parse(CategoryList.SelectedValue);")]),o("p",[e._v("theProduct.QuantityPerUnit ="),o("br"),e._v("\nstring.IsNullOrEmpty(QuantityPerUnit.Text) ? null :")]),o("p",[e._v("QuantityPerUnit.Text;")]),o("p",[e._v("if (string.IsNullOrEmpty(UnitPrice.Text))")]),o("p",[e._v("{")]),o("p",[e._v("theProduct.UnitPrice = null;")]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("theProduct.UnitPrice = decimal.Parse(UnitPrice.Text);")]),o("p",[e._v("}")]),o("p",[e._v("if (string.IsNullOrEmpty(UnitsInStock.Text))")]),o("p",[e._v("{")]),o("p",[e._v("theProduct.UnitsInStock = null;")]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("theProduct.UnitsInStock = short.Parse(UnitsInStock.Text);")]),o("p",[e._v("}")]),o("p",[e._v("if (string.IsNullOrEmpty(UnitsOnOrder.Text))")]),o("p",[e._v("{")]),o("p",[e._v("theProduct.UnitsOnOrder = null;")]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("theProduct.UnitsOnOrder = short.Parse(UnitsOnOrder.Text);")]),o("p",[e._v("}")]),o("p",[e._v("if (string.IsNullOrEmpty(ReorderLevel.Text))")]),o("p",[e._v("{")]),o("p",[e._v("theProduct.ReorderLevel = null;")]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("theProduct.ReorderLevel = short.Parse(ReorderLevel.Text);")]),o("p",[e._v("}")]),o("p",[e._v("theProduct.Discontinued = Discontinued.Checked;")]),o("p",[e._v("//make your call and capture the new identity productid")]),o("p",[e._v("int rowsaffected = sysmgr.Product_Update(theProduct);")]),o("p",[e._v("//test to determine if an update was done")]),o("p",[e._v("if (rowsaffected == 0)")]),o("p",[e._v("{")]),o("p",[e._v('ProductID.Text = "";')]),o("p",[e._v("//Refresh the dropdownlist to reflect the missing record")]),o("p",[e._v("BindProductList();")]),o("p",[e._v("//communicate to the user")]),o("p",[e._v('errormsgs.Add("Product is no longer on the database. ");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-warning");')]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("//Refresh the dropdownlist to reflect the missing record")]),o("p",[e._v("BindProductList();")]),o("p",[e._v("ProductList.SelectedValue = ProductID.Text;")]),o("p",[e._v("//communicate to the user")]),o("p",[e._v('errormsgs.Add("Product has been updated. ");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-success");')]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("blockquote",[o("p",[e._v("catch (DbUpdateException ex)")])]),o("p",[e._v("{")]),o("p",[e._v("UpdateException updateException ="),o("br"),e._v("\n(UpdateException)ex.InnerException;")]),o("p",[e._v("if (updateException.InnerException != null)")]),o("p",[e._v("{")]),o("blockquote",[o("p",[e._v("errormsgs.Add(updateException.InnerException.Message.ToString());")])]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("errormsgs.Add(updateException.Message);")]),o("p",[e._v("}")]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-danger");')]),o("p",[e._v("}")]),o("p",[e._v("catch (DbEntityValidationException ex)")]),o("p",[e._v("{")]),o("p",[e._v("foreach (var entityValidationErrors in ex.EntityValidationErrors)")]),o("p",[e._v("{")]),o("p",[e._v("foreach (var validationError in"),o("br"),e._v("\nentityValidationErrors.ValidationErrors)")]),o("p",[e._v("{")]),o("p",[e._v('errormsgs.Add(" Error: " + validationError.ErrorMessage);')]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-danger");')]),o("p",[e._v("}")]),o("p",[e._v("catch (Exception ex)")]),o("p",[e._v("{")]),o("p",[e._v("errormsgs.Add(GetInnerException(ex).ToString());")]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-danger");')]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("Implement the DeleteProduct event. Double click the Delete linkbutton on the"),o("br"),e._v("\nDesign view. The delete of the product record will be an update to the"),o("br"),e._v("\nDiscontinued flag. The delete needs only to send the productid to the BLL"),o("br"),e._v("\nmethod. The setting of the Discontinued field should not be left to the user to"),o("br"),e._v("\nremember or figure out.")]),o("p",[e._v("Add an ajax confirmation button extender to the Delete linkbutton.")]),o("p",[e._v("protected void RemoveProduct_Click(object sender, EventArgs e)")]),o("p",[e._v("{")]),o("p",[e._v("if (string.IsNullOrEmpty(ProductID.Text))")]),o("p",[e._v("{")]),o("p",[e._v('errormsgs.Add("Please select a product to update. Select and Search.");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-info");')]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("try")]),o("p",[e._v("{")]),o("p",[e._v("//connect to the required controller")]),o("p",[e._v("ProductController sysmgr = new ProductController();")]),o("p",[e._v("//make your call and capture the new identity productid")]),o("p",[e._v("int rowsaffected = sysmgr.Product_Delete(int.Parse(ProductID.Text));")]),o("p",[e._v("//test to determine if an update was done")]),o("p",[e._v("if (rowsaffected == 0)")]),o("p",[e._v("{")]),o("p",[e._v('ProductID.Text = "";')]),o("p",[e._v("//Refresh the dropdownlist to reflect the missing record")]),o("p",[e._v("BindProductList();")]),o("p",[e._v("//communicate to the user")]),o("p",[e._v('errormsgs.Add("Product is no longer on the database. ");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-warning");')]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("//Refresh the dropdownlist to reflect the missing record")]),o("p",[e._v("BindProductList();")]),o("p",[e._v('ProductID.Text = "";')]),o("p",[e._v("Discontinued.Checked = true;")]),o("p",[e._v("//communicate to the user")]),o("p",[e._v('errormsgs.Add("Product has been discontinued. ");')]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-success");')]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("blockquote",[o("p",[e._v("catch (DbUpdateException ex)")])]),o("p",[e._v("{")]),o("p",[e._v("UpdateException updateException ="),o("br"),e._v("\n(UpdateException)ex.InnerException;")]),o("p",[e._v("if (updateException.InnerException != null)")]),o("p",[e._v("{")]),o("blockquote",[o("p",[e._v("errormsgs.Add(updateException.InnerException.Message.ToString());")])]),o("p",[e._v("}")]),o("p",[e._v("else")]),o("p",[e._v("{")]),o("p",[e._v("errormsgs.Add(updateException.Message);")]),o("p",[e._v("}")]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-danger");')]),o("p",[e._v("}")]),o("p",[e._v("catch (DbEntityValidationException ex)")]),o("p",[e._v("{")]),o("p",[e._v("foreach (var entityValidationErrors in ex.EntityValidationErrors)")]),o("p",[e._v("{")]),o("p",[e._v("foreach (var validationError in"),o("br"),e._v("\nentityValidationErrors.ValidationErrors)")]),o("p",[e._v("{")]),o("p",[e._v('errormsgs.Add(" Error: " + validationError.ErrorMessage);')]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-danger");')]),o("p",[e._v("}")]),o("p",[e._v("catch (Exception ex)")]),o("p",[e._v("{")]),o("p",[e._v("errormsgs.Add(GetInnerException(ex).ToString());")]),o("p",[e._v('LoadMessageDisplay(errormsgs, "alert alert-danger");')]),o("p",[e._v("}")]),o("p",[e._v("}")]),o("p",[e._v("}")])])}],a=r(0),n=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},o,!1,null,null,null);n.options.__file="lesson-2.md";t.default=n.exports}}]);