(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{472:function(e,t,n){"use strict";n.r(t);var a=n(42),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p",[e._v("Performing Inserts (Tutorial 4 of 9)\nHands-On Tutorials for Application Programming 1 (DMIT152)\nContents at a Glance\nIntroduction\t1\nPerforming Inserts\t2")]),e._v(" "),n("p",[e._v("Detailed Contents\nIntroduction\t1\nPerforming Inserts\t2\nPurpose\t2\nSetup\t2\nPart 1 – Coding the DAL and BLL for Database Inserts\t2\nPart 2 – Inserting Data Through a Web Form\t3\nPart 3 – Performing Validation in a Web Form\t6\nPart 4 – (Advanced) Uploading Images through a Web Form\t9\nOn Your Own\t16\nSummary\t16\nDiscussion Points\t16")]),e._v(" "),n("p",[e._v("Introduction\nThis series of hands-on tutorials are designed to demonstrate how to build a web application that uses a Client-Server architecture and that persists information in a database. Each tutorial will walk the reader through steps to build upon a specific web application scenario based upon the Northwind Traders database.\nThere are nine tutorials in this package. Each hands-on tutorial has a Starter Kit folder with all of the required material to begin the tutorial and a Solution folder with the final product of the tutorial.\nPerforming Inserts\n•\tEstimated time: 30 minutes.\n•\tParts 1-3 show how to insert data in the Products table. Part 4 shows how to insert data in the Categories table (including saving images to the database).")]),e._v(" "),n("ol",[n("li",[n("p",[e._v("Part 1 – Coding the DAL and BLL for Database Inserts –\nThis part of the tutorial walks the reader through creating the BLL and DAL code to perform database inserts.")])]),e._v(" "),n("li",[n("p",[e._v("Part 2 – Inserting Data through a Web Form –\nThis part focuses on gathering user input through a web form in order to insert data into a database.")])]),e._v(" "),n("li",[n("p",[e._v("Part 3 – Performing Validation in a Web Form –\nThis part focuses on validating user input before submitting data to the system. Client-side validation is performed through the use of Validator controls. Validation is further enforced through code-behind validation which takes place when the browser performs a post-back.")])]),e._v(" "),n("li",[n("p",[e._v("Part 4 – (Advanced) Uploading Images through a Web Form –\nThis part walks the reader through the steps to upload an image through a web form for the purposes of storing it in a database.\nPurpose\nThis hands-on tutorial walks through the steps to support inserting a row of data from a web form into a database.\nThe general steps required to support data inserts are as follows:")])]),e._v(" "),n("li",[n("p",[e._v("Create the needed DAL/BLL methods – In the DAL’s provider class for the table you wish to add to, create a method that takes the CBO for the table and call the stored procedure to insert the data. A BLL method must also be added to the related controller class.")])]),e._v(" "),n("li",[n("p",[e._v("Modify the Web form – Add a button to the web form and send the user’s input to the related BLL class.\nSetup\nThis lab builds on the Visual Studio solution and database from the previous topic(s). The Starter Kit folder contains these resources.\nPart 1 – Coding the DAL and BLL for Database Inserts\nThis part of the tutorial walks the reader through creating the BLL and DAL code to perform database inserts.")])]),e._v(" "),n("li",[n("p",[e._v('In the DAL folder of the NorthwindSystem project, open the ProductProvider.cs file and write this method to add data to the Products table in the database.\npublic int Add(Product item)\n{\nreturn Convert.ToInt32(DataStore.ExecuteScalar("Products_Add",\nitem.ProductName,\nitem.SupplierID,\nitem.CategoryID,\nitem.QuantityPerUnit,\nitem.UnitPrice,\nitem.UnitsInStock,\nitem.UnitsOnOrder,\nitem.ReorderLevel,\nitem.Discontinued));\n}')])]),e._v(" "),n("li",[n("p",[e._v("Open the ProductController.cs file in the BLL folder. Add the following method.\npublic int AddProduct(Product info)\n{\nreturn DataProvider.Add(info);\n}")])])]),e._v(" "),n("p",[e._v("Part 2 – Inserting Data Through a Web Form\nThis part focuses on gathering user input through a web form in order to insert data into a database.")]),e._v(" "),n("ol",[n("li",[n("p",[e._v("In the web site, open the AddEditProduct.aspx form and add a LinkButton to the end of the form, as in the following screen shot. Give it an ID of “AddProduct”.")])]),e._v(" "),n("li",[n("p",[e._v("Double-click the AddProduct button to create the event handler in the form’s code-behind file. In that method, enter the following code.\nprotected void AddProduct_Click(object sender, EventArgs e)\n{\ntry\n{\nProduct item = new Product();\nitem.ProductName = ProductName.Text;\nif(!string.IsNullOrEmpty(Supplier.SelectedValue))\nitem.SupplierID = int.Parse(Supplier.SelectedValue);\nif (!string.IsNullOrEmpty(Category.SelectedValue))\nitem.CategoryID = int.Parse(Category.SelectedValue);\nif (!string.IsNullOrEmpty(QtyPerUnit.Text))\nitem.QuantityPerUnit = QtyPerUnit.Text;\nif (!string.IsNullOrEmpty(UnitPrice.Text))\nitem.UnitPrice = decimal.Parse(UnitPrice.Text);\nif (!string.IsNullOrEmpty(InStock.Text))\nitem.UnitsInStock = int.Parse(InStock.Text);\nif (!string.IsNullOrEmpty(InStock.Text))\nitem.UnitsOnOrder = int.Parse(OnOrder.Text);\nif (!string.IsNullOrEmpty(InStock.Text))\nitem.ReorderLevel = int.Parse(ReorderLevel.Text);\nitem.Discontinued = Discontinued.Checked;")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('    ProductController Controller = new ProductController();\n    int NewProductId = Controller.AddProduct(item);\n\n    // Update the form and give feedback to the user\n    PopulateCurrentProductsDropdown();\n    this.CurrentProducts.SelectedValue = NewProductId.ToString();\n    ProductID.Text = NewProductId.ToString();\n    this.MessageLabel.Text = "Product added";\n}\ncatch (Exception ex)\n{\n    this.MessageLabel.Text = ex.Message;\n}\n')])])]),n("p",[e._v("}")])]),e._v(" "),n("li",[n("p",[e._v("View the form in the browser to test the functionality with valid data, as shown in the samples below. The new product should be successfully inserted into the database.\na.\tTesting with complete data")])])]),e._v(" "),n("p",[e._v("b.\tTesting with “empty” data for items that can be null.")]),e._v(" "),n("p",[e._v("Part 3 – Performing Validation in a Web Form\nThis part focuses on validating user input before submitting data to the system. Client-side validation is performed through the use of Validator controls. Validation is further enforced through code-behind validation which takes place when the browser performs a post-back.")]),e._v(" "),n("ol",[n("li",[e._v("Open the AddEditProduct.aspx form and add validation controls as shown in the image and chart below. Each validation control must identify which user input control (typically TextBox controls) it is validating. They also must have certain properties set to the appropriate values to complete the validation and give feedback to the user when errors occur.")])]),e._v(" "),n("p",[e._v("Type of Control\tControl To Validate\tError Message\tOther Property Values\nRequiredFieldValidator\tProductName\tProduct Name is required.\nCompareValidator\tUnitPrice\tMust be a real number greater than zero.\tOperator: GreaterThan\nType: Double\nValueToCompare: 0\nCompareValidator\tInStock\tMust be a whole number.\tOperator: DataTypeCheck\nType: Integer\nCompareValidator\tOnOrder\tMust be a whole number greater than or equal to zero.\tOperator: GreaterThanEqual\nType: Integer\nValueToCompare: 0\nCompareValidator\tReorderLevel\tMust be a whole number greater than or equal to zero.\tOperator: GreaterThanEqual\nType: Integer\nValueToCompare: 0")]),e._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[e._v("Add a ValidationSummary control to the form next to the MessageLabel.")])]),e._v(" "),n("li",[n("p",[e._v("Modify the ShowProductDetails button by settings its CausesValidation property to false.")])]),e._v(" "),n("li",[n("p",[e._v("Modify the AddProduct_Click() method in the form’s code-behind to now include a check for the form’s IsValid property (which is set by the validation controls on postback).\nprotected void AddProduct_Click(object sender, EventArgs e)\n{\nif (IsValid)\ntry\n{\nProduct item = new Product();\nitem.ProductName = ProductName.Text;\nif (!string.IsNullOrEmpty(Supplier.SelectedValue))\nitem.SupplierID = int.Parse(Supplier.SelectedValue);\nif (!string.IsNullOrEmpty(Category.SelectedValue))\nitem.CategoryID = int.Parse(Category.SelectedValue);\nif (!string.IsNullOrEmpty(QtyPerUnit.Text))\nitem.QuantityPerUnit = QtyPerUnit.Text;\nif (!string.IsNullOrEmpty(UnitPrice.Text))\nitem.UnitPrice = decimal.Parse(UnitPrice.Text);\nif (!string.IsNullOrEmpty(InStock.Text))\nitem.UnitsInStock = int.Parse(InStock.Text);\nif (!string.IsNullOrEmpty(InStock.Text))\nitem.UnitsOnOrder = int.Parse(OnOrder.Text);\nif (!string.IsNullOrEmpty(InStock.Text))\nitem.ReorderLevel = int.Parse(ReorderLevel.Text);\nitem.Discontinued = Discontinued.Checked;")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('        ProductController Controller = new ProductController();\n        int NewProductId = Controller.AddProduct(item);\n\n        // Update the form and give feedback to the user\n        PopulateCurrentProductsDropdown();\n        this.CurrentProducts.SelectedValue = NewProductId.ToString();\n        ProductID.Text = NewProductId.ToString();\n        this.MessageLabel.Text = "Product added";\n    }\n    catch (Exception ex)\n    {\n        this.MessageLabel.Text = ex.Message;\n    }\n')])])]),n("p",[e._v("}")])]),e._v(" "),n("li",[n("p",[e._v("Test the form in a browser. Attempt to enter invalid data in the form; clicking the AddProduct button with invalid data should present the user with error messages. Entering correct information should allow the product to be added to the database. Also check that the ShowProductDetails button works correctly.")])])]),e._v(" "),n("p",[e._v("Part 4 – (Advanced) Uploading Images through a Web Form\nThis part walks the reader through the steps to upload an image through a web form for the purposes of storing it in a database.\nPreparing the Category Class\nOne of the oddities about images in the NorthwindExtended database is that these images have an extra 78 bytes of data at the start of every image. These 78 bytes are exactly the same for each image, because they represent an OLE (Object Linking and Embedding) header for use in older technology from the 1990s.\nSince the Category’s Picture property is meant to store the image as a byte array, it is important (for consistency) to make sure that any value stored in this property has the OLE header. Therefore, the following steps are required in our system.")]),e._v(" "),n("ol",[n("li",[e._v("In the NorthwindEntities project, add another class called ImageHelper with the following code.\nusing System;\nusing System.Collections.Generic;")])]),e._v(" "),n("p",[e._v("namespace NorthwindEntities.Common\n{\n/// <summary>\n/// The ImageHelper class helps to compensate for the OLE Header\n/// that appears at the start of legacy image data stored in the\n/// Northwinds database.\n/// </summary>\ninternal class ImageHelper\n{\n// See http://www.codeguru.com/vb/vb_internet/aspnet/print.php/c16095\nprivate static Byte[] _OleHeader = { 21, 28, 47, 0, 2, 0, 0, 0, 13, 0, 14, 0, 20, 0, 33, 0, 255, 255, 255, 255, 66, 105, 116, 109, 97, 112, 32, 73, 109, 97, 103, 101, 0, 80, 97, 105, 110, 116, 46, 80, 105, 99, 116, 117, 114, 101, 0, 1, 5, 0, 0, 2, 0, 0, 0, 7, 0, 0, 0, 80, 66, 114, 117, 115, 104, 0, 0, 0, 0, 0, 0, 0, 0, 0, 160, 41, 0, 0 };\npublic static Byte[] OleHeader\n{\nget\n{\nreturn _OleHeader;\n}\n}")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('    public static bool HasOleHeader(Byte[] rawPicture)\n    {\n        bool hasHeader = true;\n        if (rawPicture != null && rawPicture.Length &gt; OleHeader.Length)\n            for (int index = 0; index &lt;= OleHeader.Length - 1; index++)\n            {\n                if (OleHeader[index] != rawPicture[index])\n                {\n                    hasHeader = false;\n                    break;\n                }\n            }\n        else\n            hasHeader = false;\n        return hasHeader;\n    }\n\n    public static Byte[] AddOleHeader(Byte[] rawPicture)\n    {\n        if (rawPicture == null || rawPicture.Length == 0)\n            throw new ArgumentException("RawPicture is null or empty.", "RawPicture");\n        if (!HasOleHeader(rawPicture))\n        {\n            List&lt;byte&gt; picture = new List&lt;byte&gt;(OleHeader);\n            picture.AddRange(rawPicture);\n            rawPicture = picture.ToArray();\n        }\n        return rawPicture;\n    }\n}\n')])])]),n("p",[e._v("}")]),e._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[e._v("Open the Category.cs file and modify the Picture property of the class to match the following code.\nprivate Byte[] _Picture;\npublic Byte[] Picture\n{\nget\n{\nreturn _Picture;\n}\nset\n{\nif (value != null)\nif (value.Length == 0)\nvalue = null;\nelse\nvalue = ImageHelper.AddOleHeader(value);\n_Picture = value;\n}\n}")])]),e._v(" "),n("p",[e._v("Preparing the DAL and BLL\nThe DAL and BLL don’t need any special logic for handling images when adding to the database. The code required here is very similar to that used for the ProductProvider and ProductController classes.")]),e._v(" "),n("ol",[n("li",[n("p",[e._v('In the DAL folder of the NorthwindSystem project, open the CategoryProvider.cs file and code the following method to add data to the Categories table in the database.\npublic int Add(Category item)\n{\nreturn Convert.ToInt32(DataStore.ExecuteScalar("Categories_Add",\nitem.CategoryName,\nitem.Description,\nitem.Picture);\n}')])]),e._v(" "),n("li",[n("p",[e._v("Open the CategoryController.cs file in the BLL folder. Add the following method.\npublic int AddCategory(Category info)\n{\nreturn DataProvider.Add(info);\n}\nModifying the Form\nUploading images in the form is made possible through the use of the FileUpload control.")])]),e._v(" "),n("li",[n("p",[e._v("In the web site, open the AddEditCategory.aspx form and append a new row to the end of the table, as shown in the following screen shot.")])]),e._v(" "),n("li",[n("p",[e._v("Add a FileUpload control to the form and give it an ID of “CategoryImageUpload”.")])]),e._v(" "),n("li",[n("p",[e._v("At the end of the form, add a LinkButton to allow the user to submit the data. Give the button an ID of “AddCategory”.")])]),e._v(" "),n("li",[n("p",[e._v("Double-click the AddCategory button to create the event handler in the form’s code-behind. In that event handler, enter the following code.\nprotected void AddProduct_Click(object sender, EventArgs e)\n{\ntry\n{\nCategory item = new Category();\nitem.CategoryName = CategoryName.Text;\nif (!string.IsNullOrEmpty(Description.Text))\nitem.Description = Description.Text;\nitem.Picture = GetUploadedPicture();")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    CategoryController controller = new CategoryController();\n    int addedCategoryID = controller.AddCategory(item);\n    // Update the form and give feedback to the user\n    // TODO: complete this code later…\n}\ncatch (Exception ex)\n{\n    this.MessageLabel.Text = ex.Message;\n}\n")])])]),n("p",[e._v("}")])]),e._v(" "),n("li",[n("p",[e._v("To provide the functionality that will retrieve the uploaded image, add the GetUploadedPicture() method to the form’s code-behind file. You will also need to add a using statement at the top of the file to import the System.IO namespace.\nusing System.IO; // place at top of AddEditCategoy.aspx.cs")]),e._v(" "),n("p",[e._v('private byte[] GetUploadedPicture()\n{\nbyte[] thePicture = null;\nif (this.CategoryImageUpload.HasFile && this.CategoryImageUpload.PostedFile != null)\n{\nstring extention = Path.GetExtension(CategoryImageUpload.PostedFile.FileName).ToLower();\nstring MIMEType = "image/" + extention.Replace(".", "");\nif (WebClient.UI.Handlers.AbstractStreamableImage.ImageFormats.ContainsValue(MIMEType))\n{\nlong size = this.CategoryImageUpload.PostedFile.InputStream.Length;\nif (size < int.MaxValue - 78) // minus 78 is to allow for the OLE header\n{\nbyte[] ImageBytes = new byte[size];\nthis.CategoryImageUpload.PostedFile.InputStream.Read(ImageBytes, 0, (int)size);\nthePicture = ImageBytes;\n}\nelse\nthrow new Exception("Image is too big. Images must be smaller than " +\nint.MaxValue.ToString() + " btyes in size.");\n}\nelse\n{\nthrow new Exception("Invalid file type uploaded - only picture files are allowed.");\n}\n}\nreturn thePicture;\n}')])]),e._v(" "),n("li",[n("p",[e._v("Give feedback to the user by repopulating the DropDownList of categories and displaying a message to the user.\na.\tSince the code to repopulate the DropDownList is the same as the kind in the Page’s Load event, it makes sense to extract the common code into a separate method. Begin by editing the Page_Load() method and creating a separate method to fill the DropDownList.\nprotected void Page_Load(object sender, EventArgs e)\n{\nif (!IsPostBack)\n{\ntry\n{\nPopulateCategoryDropdown();\n}\ncatch (Exception ex)\n{\nMessageLabel.Text = ex.Message;\n}\n}\n}")]),e._v(" "),n("p",[e._v('private void PopulateCategoryDropdown()\n{\n// Populate Category drop-down\nCategoryController controller = new CategoryController();\nList<Category> categories = controller.ListAllCategories();\nCurrentCategories.DataSource = categories;\nCurrentCategories.DataTextField = "CategoryName";\nCurrentCategories.DataValueField = "CategoryID";\nCurrentCategories.DataBind();\nCurrentCategories.Items.Insert(0, "[select a category]");\n}')])])]),e._v(" "),n("p",[e._v("b.\tModify AddCategory_Click()to call the PopulateCategoryDropDown() method and display text to the user when the new category is added. Also, since a picture may have been uploaded, it should be shown in the browser.\nprotected void AddProduct_Click(object sender, EventArgs e)\n{\ntry\n{\nCategory item = new Category();\nitem.CategoryName = CategoryName.Text;\nif (!string.IsNullOrEmpty(Description.Text))\nitem.Description = Description.Text;")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('        CategoryController controller = new CategoryController();\n        int addedCategoryID = controller.AddCategory(item);\n        // Update the form and give feedback to the user\n        PopulateCategoryDropdown();\n        this.CurrentCategories.SelectedValue = addedCategoryID.ToString();\n        CategoryID.Text = addedCategoryID.ToString();\n        if (item.Picture != null)\n            Picture.ImageUrl = "~/Handlers/ImageHandler.ashx?CategoryID="\n                             + addedCategoryID.ToString();\n        else\n            Picture.ImageUrl = "~/Images/NoImage_172x120.gif";\n        this.MessageLabel.Text = "New category added";\n    }\n    catch (Exception ex)\n    {\n        this.MessageLabel.Text = ex.Message;\n    }\n}\n')])])]),n("ol",{attrs:{start:"7"}},[n("li",[e._v("Test the form in the browser. Try creating a new category named “Soups” with the information below; an image has been provided in the starter kit that you can upload for this new category. A successful add should show a message to the user, identify the new category’s ID, display the uploaded picture, and select the category in the CurrentCategories DropDownList.")])]),e._v(" "),n("p",[e._v("On Your Own\nModify the form for managing Supplier information to allow users to add new suppliers. Be sure to validate user input.\nSummary\nIn this hands-on tutorial, you built the functionality to insert Product and Category information into a database. These forms will serve as the basis for later tutorials which will Update and Delete database information.\nYou also explored integrating validation of user input through the use of Validation controls. As a bonus, the steps to upload an image into the database were also covered.\nDiscussion Points\nThe following questions are designed to help you review key aspects of this tutorial\nDRAFT – discussion points not yet complete\n\tDAL\no\tCheck SPROC for parameters\n\tOrder matters for calling with Ent.Lib.\no\tExecuteScalar()\n\tReturns a single value (Decimal)\n\tUsed because SPROC returns ID of newly added item\n•\tOtherwise, use ExecuteNonQuery()\n\tDealing with Nullable property types in user input\no\tNumbers and Dates\no\tStrings – Distinguish between an empty string and NULL\nWhile empty strings won’t cause run-time errors for String properties that can be null in the database, it’s a good idea to …\n\tGiving Feedback to the user\no\tWhen errors occur\no\tWhen validating user input\no\tWhen adding\no\tWhen updating\no\tWhen deleting\n\tValidation Controls\no\tthis.IsValid\n\tSet by the validation controls on postback\n\tNeeded if browser has JavaScript disabled or if it’s bypassed by hackers\n\tChecking IsValid will trigger the responses of the validator controls, presenting messages to the user.\n\tImages in the Northwind Traders sample database.")])])}),[],!1,null,null,null);t.default=r.exports}}]);