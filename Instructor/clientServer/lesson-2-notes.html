<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EntityFramework: Data Access | CPSC-1517 Student Notes</title>
    <meta name="description" content="Introduction to Application Development">
    
    
    <link rel="preload" href="/assets/css/0.styles.59e31e97.css" as="style"><link rel="preload" href="/assets/js/app.f13cd782.js" as="script"><link rel="preload" href="/assets/js/5.ab5bbf44.js" as="script"><link rel="prefetch" href="/assets/js/2.7bbc7679.js"><link rel="prefetch" href="/assets/js/3.7e9ccf95.js"><link rel="prefetch" href="/assets/js/4.d601197d.js"><link rel="prefetch" href="/assets/js/6.2f1f9964.js"><link rel="prefetch" href="/assets/js/7.e7bd23cf.js"><link rel="prefetch" href="/assets/js/8.5c7c785d.js"><link rel="prefetch" href="/assets/js/9.7ae51752.js"><link rel="prefetch" href="/assets/js/10.500e4f07.js"><link rel="prefetch" href="/assets/js/11.5330b9a6.js"><link rel="prefetch" href="/assets/js/12.3772ea0b.js"><link rel="prefetch" href="/assets/js/13.d324d487.js"><link rel="prefetch" href="/assets/js/14.c31f0703.js"><link rel="prefetch" href="/assets/js/15.79c0067d.js"><link rel="prefetch" href="/assets/js/16.9d5efcf3.js"><link rel="prefetch" href="/assets/js/17.9ce509ed.js"><link rel="prefetch" href="/assets/js/18.cc02ad7f.js"><link rel="prefetch" href="/assets/js/19.e07767d9.js"><link rel="prefetch" href="/assets/js/20.afe5937f.js"><link rel="prefetch" href="/assets/js/21.57f1e9a4.js"><link rel="prefetch" href="/assets/js/22.d47182ce.js"><link rel="prefetch" href="/assets/js/23.15879838.js"><link rel="prefetch" href="/assets/js/24.ffb8b7f9.js"><link rel="prefetch" href="/assets/js/25.012a574f.js"><link rel="prefetch" href="/assets/js/26.f58c8b89.js"><link rel="prefetch" href="/assets/js/27.49f47940.js"><link rel="prefetch" href="/assets/js/28.8dabc266.js"><link rel="prefetch" href="/assets/js/29.8665c708.js"><link rel="prefetch" href="/assets/js/30.e4dfe482.js"><link rel="prefetch" href="/assets/js/31.aebcb925.js"><link rel="prefetch" href="/assets/js/32.7bc36913.js"><link rel="prefetch" href="/assets/js/33.2689d845.js"><link rel="prefetch" href="/assets/js/34.b1d64517.js"><link rel="prefetch" href="/assets/js/35.67a6e77d.js"><link rel="prefetch" href="/assets/js/36.a1ba6e14.js"><link rel="prefetch" href="/assets/js/37.c54b2cb3.js"><link rel="prefetch" href="/assets/js/38.fa8f5dd2.js"><link rel="prefetch" href="/assets/js/39.42dbae8d.js"><link rel="prefetch" href="/assets/js/40.410ffcb6.js"><link rel="prefetch" href="/assets/js/41.932d4877.js"><link rel="prefetch" href="/assets/js/42.2d8c9052.js"><link rel="prefetch" href="/assets/js/43.5441c765.js"><link rel="prefetch" href="/assets/js/44.ce153559.js"><link rel="prefetch" href="/assets/js/45.b65dbb3a.js"><link rel="prefetch" href="/assets/js/46.66753cd9.js"><link rel="prefetch" href="/assets/js/47.f3529e63.js"><link rel="prefetch" href="/assets/js/48.a15e44ae.js"><link rel="prefetch" href="/assets/js/49.6194ced8.js"><link rel="prefetch" href="/assets/js/50.483dd371.js"><link rel="prefetch" href="/assets/js/51.0dffef05.js"><link rel="prefetch" href="/assets/js/52.f6fd0084.js"><link rel="prefetch" href="/assets/js/53.9c00ddb2.js"><link rel="prefetch" href="/assets/js/54.5fdb69c5.js"><link rel="prefetch" href="/assets/js/55.e4952ceb.js"><link rel="prefetch" href="/assets/js/56.00c601c0.js"><link rel="prefetch" href="/assets/js/57.ba900f92.js"><link rel="prefetch" href="/assets/js/58.f692a0ff.js"><link rel="prefetch" href="/assets/js/59.d75f59bd.js"><link rel="prefetch" href="/assets/js/60.86c6e7be.js"><link rel="prefetch" href="/assets/js/61.29ce4f5d.js"><link rel="prefetch" href="/assets/js/62.fd02cd50.js"><link rel="prefetch" href="/assets/js/63.dd91fad1.js"><link rel="prefetch" href="/assets/js/64.656bc895.js"><link rel="prefetch" href="/assets/js/65.df860e0c.js"><link rel="prefetch" href="/assets/js/66.c9fb4b3e.js"><link rel="prefetch" href="/assets/js/67.11c54b72.js"><link rel="prefetch" href="/assets/js/68.3ebb5456.js"><link rel="prefetch" href="/assets/js/69.38a813aa.js"><link rel="prefetch" href="/assets/js/70.f47218a9.js"><link rel="prefetch" href="/assets/js/71.5544a116.js"><link rel="prefetch" href="/assets/js/72.dfce09c3.js"><link rel="prefetch" href="/assets/js/73.88d01397.js"><link rel="prefetch" href="/assets/js/74.6a6227d4.js"><link rel="prefetch" href="/assets/js/75.9cebf766.js"><link rel="prefetch" href="/assets/js/76.65aea59b.js"><link rel="prefetch" href="/assets/js/77.016ec321.js"><link rel="prefetch" href="/assets/js/78.4c79ed99.js"><link rel="prefetch" href="/assets/js/79.a326cc32.js"><link rel="prefetch" href="/assets/js/80.2c3e6c55.js"><link rel="prefetch" href="/assets/js/81.cd233768.js"><link rel="prefetch" href="/assets/js/82.9de3fa40.js"><link rel="prefetch" href="/assets/js/83.324298cc.js"><link rel="prefetch" href="/assets/js/84.2c5f99b8.js"><link rel="prefetch" href="/assets/js/85.cc558c32.js"><link rel="prefetch" href="/assets/js/86.8f6411d4.js"><link rel="prefetch" href="/assets/js/87.39d4e7e2.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.8832ec7c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.59e31e97.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      CPSC-1517 Student Notes
    </span></a><div class="links"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form><nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">Home</a></div><div class="nav-item"><a href="/logs/" class="nav-link">LOGs</a></div><div class="nav-item"><a href="/csharp/" class="nav-link">C-Sharp</a></div><div class="nav-item"><a href="/html/" class="nav-link">Html</a></div><div class="nav-item"><a href="/razor/" class="nav-link">Razor</a></div><div class="nav-item"><a href="/clientserver/" class="nav-link">Client-Server</a></div><div class="nav-item"><a href="/webforms/" class="nav-link">Webforms</a></div><div class="nav-item"><a href="https://cpsc-1517.github.io/LabSpecs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lab Specs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/CPSC-1517/CPSC-1517.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">Home</a></div><div class="nav-item"><a href="/logs/" class="nav-link">LOGs</a></div><div class="nav-item"><a href="/csharp/" class="nav-link">C-Sharp</a></div><div class="nav-item"><a href="/html/" class="nav-link">Html</a></div><div class="nav-item"><a href="/razor/" class="nav-link">Razor</a></div><div class="nav-item"><a href="/clientserver/" class="nav-link">Client-Server</a></div><div class="nav-item"><a href="/webforms/" class="nav-link">Webforms</a></div><div class="nav-item"><a href="https://cpsc-1517.github.io/LabSpecs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lab Specs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/CPSC-1517/CPSC-1517.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>EntityFramework: Data Access</span><!----></p><ul class="sidebar-group-items"><li><a href="/Instructor/clientServer/lesson-2-notes.html#entityframework-in-logical-client-server-architecture" class="sidebar-link">EntityFramework in logical Client Server Architecture</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-2-notes.html#coding-create-entity-class" class="sidebar-link">Coding: Create Entity class</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-2-notes.html#common-annotations" class="sidebar-link">Common Annotations:</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Instructor/clientServer/lesson-2-notes.html#table-“sql-tablename”-schema-“sql-schemaname”" class="sidebar-link">[Table(“sql tablename”,Schema=“sql schemaname”)]</a></li><li class="sidebar-sub-header"><a href="/Instructor/clientServer/lesson-2-notes.html#key-column-order-n-databasegenerated-databasegeneratedoption-xxxxxx" class="sidebar-link">[Key, Column(Order=n),DatabaseGenerated(DatabaseGeneratedOption.xxxxxx]</a></li><li class="sidebar-sub-header"><a href="/Instructor/clientServer/lesson-2-notes.html#databasegenerated-databasegeneratedoption-computed" class="sidebar-link">[DatabaseGenerated(DatabaseGeneratedOption.Computed]</a></li><li class="sidebar-sub-header"><a href="/Instructor/clientServer/lesson-2-notes.html#foreignkey-“tablename”-do-not-use-unless-necessary" class="sidebar-link">[ForeignKey(“tablename”)] (do not use unless necessary)</a></li><li class="sidebar-sub-header"><a href="/Instructor/clientServer/lesson-2-notes.html#notmapped" class="sidebar-link">[NotMapped]</a></li></ul></li><li><a href="/Instructor/clientServer/lesson-2-notes.html#entity-products" class="sidebar-link">Entity:Products</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-2-notes.html#coding-create-dal-context-class" class="sidebar-link">Coding: Create DAL Context class</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Instructor/clientServer/lesson-2-notes.html#northwindsystem-dal-northwindcontext" class="sidebar-link">NorthwindSystem.DAL.NorthwindContext:</a></li></ul></li><li><a href="/Instructor/clientServer/lesson-2-notes.html#coding-configuration-setup" class="sidebar-link">Coding: Configuration setup</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-2-notes.html#assembly-information…" class="sidebar-link">Assembly Information…</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-2-notes.html#exercise" class="sidebar-link">Exercise:</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="entityframework-data-access"><a href="#entityframework-data-access" aria-hidden="true" class="header-anchor">#</a> EntityFramework: Data Access</h1><p>When ASP.Net first started, users used ADO.Net to access the database. This required mounts of work, redundant setup work. As time went on, as usual, 3rd party individuals attempted to reduce the amount of work needed to access the database using ADO.Net. One popular library was Enterprise Library. This reduce the redundant tedious work of using ADO.net directly. In about 2008, Microsoft introduce EntityFramework to assist developers with database access. ADO.Net was even further removed from developer (hidden). EntityFramework is a set of classes that manage your database access. One links into EntityFramework via inheriting its DBContext class. Using the <code>DBSet&lt;T&gt;</code> of this context class (where <code>&lt;T&gt;</code> is an entity definition class) and properly annotated entity definition class, database CRUD management has been greatly simplified. <strong>In this course, the entity definition classes will be coded manually by the student so they can get a better understanding of the components needed by EnityFramework. Do not reverse engineer the entities. This will be covered in DMIT2018.</strong></p><p><a href="https://en.wikipedia.org/wiki/Entity_Framework" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Entity_Framework<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="http://www.entityframeworktutorial.net/what-is-entityframework.aspx" target="_blank" rel="noopener noreferrer">http://www.entityframeworktutorial.net/what-is-entityframework.aspx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="entityframework-in-logical-client-server-architecture"><a href="#entityframework-in-logical-client-server-architecture" aria-hidden="true" class="header-anchor">#</a> EntityFramework in logical Client Server Architecture</h2><p>EntityFramework will manage the access of data to and from the database (aqua color). The DAL layer will contain a class which will be referred to as the Context class. This class will inherit DbContext from EntityFramework. The commands to query, add, update and delete records will be coded in the BLL classes using the DAL Context Class. The mapping of the sql tables will be done in the Entity classes of the Entity library. These entity classes will be used by the DAL, BLL and PL layers. These classes are data definitions of the sql tables.</p><p><img src="/assets/img/65a79bacad56128241e52332894cdcf0.65a79bac.png" alt></p><h2 id="coding-create-entity-class"><a href="#coding-create-entity-class" aria-hidden="true" class="header-anchor">#</a> Coding: Create Entity class</h2><p>When creating your entity class, you are mapping a sql table to a set of properties. The basics of objects does not change. You usually have public properties (private data members if fully implemented) and constructors. What you also have is annotations that are used to assist in the mapping. There are some defaults. Example the [Key] annotation is place with the property that is mapped to the primary key of the sql database. If the name of the property is the same as the name of the sql attribute AND that attribute ends in Id or ID, the [Key] annotation is not needed. If the primary key is an identity attribute, then no other parameters are need for the [Key] annotation.</p><p>Required <strong>using</strong> Namespace statements:</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token preprocessor property">#<span class="token directive keyword">region</span> Additional Namespaces</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>DataAnnotations<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>DataAnnotations<span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
</code></pre></div><h2 id="common-annotations"><a href="#common-annotations" aria-hidden="true" class="header-anchor">#</a> Common Annotations:</h2><h3 id="table-“sql-tablename”-schema-“sql-schemaname”"><a href="#table-“sql-tablename”-schema-“sql-schemaname”" aria-hidden="true" class="header-anchor">#</a><code>[Table(“sql tablename”,Schema=“sql schemaname”)]</code></h3><p>The <code>Table</code> annotation is placed before the public class classname. Use to map sql table to the class entity definition. If the sql database does not have subschemas then the ,Schema(“sql schemaname’) is not needed. If you wish to use it, use dbo as the schemaname.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">Table</span><span class="token punctuation">(</span>“myTable”<span class="token punctuation">)</span><span class="token punctuation">]</span> or <span class="token punctuation">[</span><span class="token class-name">Table</span><span class="token punctuation">(</span>“myTable”<span class="token punctuation">,</span>Schema<span class="token operator">=</span>“Sales”<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> myTable<span class="token punctuation">{</span>…<span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">public</span> <span class="token keyword">class</span> myTable<span class="token punctuation">{</span>…<span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h3 id="key-column-order-n-databasegenerated-databasegeneratedoption-xxxxxx"><a href="#key-column-order-n-databasegenerated-databasegeneratedoption-xxxxxx" aria-hidden="true" class="header-anchor">#</a><code>[Key, Column(Order=n),DatabaseGenerated(DatabaseGeneratedOption.xxxxxx]</code></h3><p>The <code>[Key]</code> annotation is place with the property that is mapped to the primary key of the sql database. If the name of the property is the same as the name of the sql attribute AND that attribute ends in Id or ID, the <code>[Key]</code> annotation is not needed. If the primary key is an identity attribute, then no other parameters are need for the <code>[Key]</code> annotation. The Column parameter is used if the primary key is a compound key. Each property making up the compound key needs an annotation. The Order=n starts at 1 (logical count <strong>not</strong> index) and positions the order of the properties to the order of the compound key. The DatabaseGenerated parameter is used to identify the field type of the sql attribute key. <code>Xxxxxx</code> can be <code>Computed</code>, <code>Identity</code> or <code>None</code>. The <code>Identity</code> option is the default. If your sql pkey is an identity key, you do not have to use this parameter. None indicates the user will supply the pkey value. Computed is used if the sql attribute is a computed attribute.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">Key</span><span class="token punctuation">]</span> <span class="token comment">// ( a sql identity primary key with a name ending in ID or Id)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> myIdentityPkeyID<span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">Key</span><span class="token punctuation">,</span><span class="token function">Column</span><span class="token punctuation">(</span>Order<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// (a compound primary key of 2 attributes)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> firstCompoundPFkeyID<span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token class-name">Key</span><span class="token punctuation">,</span><span class="token function">Column</span><span class="token punctuation">(</span>Order<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> secondCompoundPFkeyID<span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">Key</span><span class="token punctuation">,</span><span class="token function">DatabaseGenerated</span><span class="token punctuation">(</span>DatabaseGeneratedOption<span class="token punctuation">.</span>None<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">//( a sql user supplied primary key)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> myIdentityPkeyID<span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><h3 id="databasegenerated-databasegeneratedoption-computed"><a href="#databasegenerated-databasegeneratedoption-computed" aria-hidden="true" class="header-anchor">#</a><code>[DatabaseGenerated(DatabaseGeneratedOption.Computed]</code></h3><p>If you have a computed sql attribute, place the DatabaseGenerated annotation before it. This will map the property to the attribute but also indicate that on DML insert and update no value will be supplied by the user. Assume the sql attribute Total is computed using GST and SubTotal.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">decimal</span> SubTotal <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">decimal</span> GST <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token class-name">DatabaseGenerated</span><span class="token punctuation">(</span>DatabaseGeneratedOption<span class="token punctuation">.</span>Computed<span class="token punctuation">]</span> <span class="token comment">// (no value from user)</span>
<span class="token keyword">public</span> <span class="token keyword">decimal</span> Total <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="foreignkey-“tablename”-do-not-use-unless-necessary"><a href="#foreignkey-“tablename”-do-not-use-unless-necessary" aria-hidden="true" class="header-anchor">#</a><code>[ForeignKey(“tablename”)]</code> (<strong>do not use unless necessary</strong>)</h3><p>The foreign key annotation is only necessary if the sql foreign key attribute name is different than the sql primary key name. If the FKey name is the same as the PKey name do not use this attribute.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">ForeignKey</span><span class="token punctuation">(</span>“pkeytablename”<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> differentFKeyPkeyname <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="notmapped"><a href="#notmapped" aria-hidden="true" class="header-anchor">#</a><code>[NotMapped]</code></h3><p>This attribute is used for properties that exist in the definition class that are not directly associated with an sql table attribute. A typical usage is for a read-only property such as Name (a concatenation of FirstName and LastName attributes).</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">NotMapped</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> LastName <span class="token operator">+</span> “<span class="token punctuation">,</span> “ <span class="token operator">+</span> FirstName<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="entity-products"><a href="#entity-products" aria-hidden="true" class="header-anchor">#</a> Entity:Products</h2><p>This entity has an optional Schema= coded. The property names <strong>match</strong> the sql attribute names. The property names <strong>do not</strong> need to be in the same order as<br>
the sql attributes <strong>if</strong> the property names match the sql attribute names. <strong>If</strong> the names <strong>do not</strong> match then the <strong>physical order</strong> of the properties<br>
are mapped to the <strong>physical order</strong> of the sql attributes. The only not null attributes are ProductID and ProductName on the sql table. Thus, the datatypes<br>
in the entity require the ? mark (except for strings). <strong>Our</strong> coding standard will be to use the <strong>singular name</strong> for the entity definition.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">region</span> Additional Namespaces</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>DataAnnotations<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>DataAnnotations<span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

<span class="token keyword">namespace</span> NorthwindSystem
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token class-name">Table</span><span class="token punctuation">(</span><span class="token string">&quot;Products&quot;</span><span class="token punctuation">,</span>Schema <span class="token operator">=</span><span class="token string">&quot;dbo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">string</span> _QuanityPerUnit<span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token class-name">Key</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> ProductID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">string</span> ProductName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token operator">?</span> SupplierID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token operator">?</span> CategoryID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> QuantityPerUnit
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> _QuanityPerUnit<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">set</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    _QuanityPerUnit <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    _QuanityPerUnit <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">decimal</span><span class="token operator">?</span> UnitPrice <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> Int16<span class="token operator">?</span> UnitsInStock <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> Int16<span class="token operator">?</span> UnitsOnOrder <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> Int16<span class="token operator">?</span> ReorderLevel <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">bool</span> Discontinued <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="coding-create-dal-context-class"><a href="#coding-create-dal-context-class" aria-hidden="true" class="header-anchor">#</a> Coding: Create DAL Context class</h2><p>The DAL Context is where we connect to EntityFramework. This is done by having our Context class inherit DbContext from EntityFramework. The constructor of our context class will pass the name of our sql connectionstring to EntityFramework. References to the tables in sql are done by using <code>DbSet&lt;T&gt;</code> where <code>&lt;T&gt;</code> is one of the entity definition classes. The DbSet is the datatype of a public property in our context class. These property names will be a plural version of the entity definition class name. Our context class access will be <strong>internal</strong> to force users of the NorthwindSystem library to access the library via the BLL methods. Right click on the DAL folder and add a class called <strong>NorthwindContext</strong>. Note the required using statements: NorthwindEntities (for entity definitions) and System.Data.Entity for obtaining necessary EntityFramework references.</p><h3 id="northwindsystem-dal-northwindcontext"><a href="#northwindsystem-dal-northwindcontext" aria-hidden="true" class="header-anchor">#</a> NorthwindSystem.DAL.NorthwindContext:</h3><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">region</span> Additional Namespaces</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>Entity<span class="token punctuation">;</span>
<span class="token keyword">using</span> Northwind<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>Entities<span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

<span class="token keyword">namespace</span> NorthwindSystem<span class="token punctuation">.</span>DAL
<span class="token punctuation">{</span>
    <span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">NorthwindContext</span><span class="token punctuation">:</span><span class="token class-name">DbContext</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">NorthwindContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">base</span><span class="token punctuation">(</span><span class="token string">&quot;NWDB&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> DbSet<span class="token operator">&lt;</span>Product<span class="token operator">&gt;</span> Products <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="coding-configuration-setup"><a href="#coding-configuration-setup" aria-hidden="true" class="header-anchor">#</a> Coding: Configuration setup</h2><p>The DAL Context is where we connect to the connectionstring for our database. On the context class constructor is a base reference to the connectionstring name. This name will be passed to EntityFramework when an instance of the context class is generated. We need to set up the connectionstring. The connectionstring could be setup in the exitings Web.config file but we will setup a separate config file for all connectionstrings and reference the new file in the Web.config file. This will allow us to alter any connection string without possibly damaging any of the other configuration values of the web site.</p><ul><li>Right click WebSite, select Add/Add New Item.. and scroll down until you file Web Configuration file.</li><li>Select and name the file <strong>WebConnectionStrings</strong>.</li><li>Delete the current contents of this new file.</li><li>Open the Web.Config file.</li><li>Locate the <code>&lt;connectionStrings&gt;</code> tag, select and copy the tag.</li><li>Return to the WebConnectionStrings file and paste.</li><li>Add the following under the existing <code>&lt;add&gt;</code> tag</li></ul><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>NWDB<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">connectionString</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Data Source=.; Initial Catalog=Northwind_CPSC1517; Integrated Security=true<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">providerName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>System.Data.SqlClient<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li>Return to the Web.config file and replace the <code>&lt;connectionStrings&gt;</code> tag with</li></ul><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connectionStrings</span> <span class="token attr-name">configSource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>WebConnectionStrings.config<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>EntityFramework likes to be helpful by creating tables for the application. When you created the entity definition, one of the annotations was <code>[Table(“tablename”)]</code>. If the tablename does not exist in the database, EntityFramework will create the table using your entity definition as the layout for the table when you initially execute the web application. Naturally, this will prevent any abort of a missing object (sql table). However, your new table will have no data. This can cause confusion as there is no abort but no data, and you probably say to yourself…Ughhhhhhh! Why!!.</p><p>To avoid this situation, you can add a new tag to the web.config file. By adding this new tag, you will prevent EntityFramework from dynamically creating new tables for you. Thus, if you do mistype the tablename in the entity definition and that tablename does not exits in the database, you will end up getting what you actually expect: an error stating this is <strong>an invalid object</strong> (the missing table).</p><ul><li>Open the web.config file</li><li>Scroll down to the <code>&lt;entityFramework&gt;</code> tag</li><li>Enter the following new tag</li></ul><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contexts</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context</span> <span class="token attr-name">disableDatabaseInitialization</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>NorthwindSystem.DAL.NorthwindContext,NorthwindSystem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contexts</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The Type parameter has two values. The first is the fully qualified class name for the context class. A fully qualified class name consists of the namespace.classname (NorthwindSystem.DAL followed by the classname .NorthwindContext). The second parameter is the assembly name for your library which is typically the project name.</p><p>One problem that I normally see is the students create their projects then realize the project name is incorrect (or just not what they wanted). The student will try to rename the project using (r/c Rename). This does not change the original assembly name. To change the assembly name you need to r/c your project library name and select Properties. This will open a window to show you the current Assembly Name and Namespace. You (the student) can then alter the values to their new desired value. It is also wise to check under the button</p><h2 id="assembly-information…"><a href="#assembly-information…" aria-hidden="true" class="header-anchor">#</a> Assembly Information…</h2><p><img src="/assets/img/d747f816502f9396b33c1d568705b4c9.d747f816.png" alt="Assembly Information…"></p><p>To ensure that the corrected assembly name is in-effect, I suggest the student open the Bin folder of the Website and locate the library dlls for Northwind (NorthwindEntities.dll, NorthwindEntities.pcb, NorthwindSystem.dll, and NorthwindSystem.pcb). Select these files and delete them. Now do a ReBuild of the Solution.</p><p>Another problem that arises with this <code>&lt;context&gt;</code> tag is typos. Assume the follow typo of the assembly name: NrthwindSystem (instead of NorthwindSystem) in<br>
the web.config file. The solution is to fix the typo.</p><p><img src="/assets/img/a00adc7c499c407d8a4b03ee492d8557.a00adc7c.png" alt></p><h2 id="exercise"><a href="#exercise" aria-hidden="true" class="header-anchor">#</a> Exercise:</h2><p>As an exercise, have your students create the entity definitions for the Suppliers and Categories sql tables. Have them update the context class with appropriate <code>DbSet&lt;T&gt;</code>. In Categories for Picture use byte[] and for PictureMimeType use string.</p></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/assets/js/5.ab5bbf44.js" defer></script><script src="/assets/js/app.f13cd782.js" defer></script>
  </body>
</html>
