<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EntityFramework: Data Access | CPSC-1517 Student Notes</title>
    <meta name="description" content="Introduction to Application Development">
    
    
    <link rel="preload" href="/assets/css/0.styles.59e31e97.css" as="style"><link rel="preload" href="/assets/js/app.6954d993.js" as="script"><link rel="preload" href="/assets/js/3.7e9ccf95.js" as="script"><link rel="prefetch" href="/assets/js/2.7bbc7679.js"><link rel="prefetch" href="/assets/js/4.d601197d.js"><link rel="prefetch" href="/assets/js/5.ab5bbf44.js"><link rel="prefetch" href="/assets/js/6.2f1f9964.js"><link rel="prefetch" href="/assets/js/7.e7bd23cf.js"><link rel="prefetch" href="/assets/js/8.5c7c785d.js"><link rel="prefetch" href="/assets/js/9.7ae51752.js"><link rel="prefetch" href="/assets/js/10.500e4f07.js"><link rel="prefetch" href="/assets/js/11.5330b9a6.js"><link rel="prefetch" href="/assets/js/12.3772ea0b.js"><link rel="prefetch" href="/assets/js/13.d324d487.js"><link rel="prefetch" href="/assets/js/14.c31f0703.js"><link rel="prefetch" href="/assets/js/15.79c0067d.js"><link rel="prefetch" href="/assets/js/16.9d5efcf3.js"><link rel="prefetch" href="/assets/js/17.9ce509ed.js"><link rel="prefetch" href="/assets/js/18.cc02ad7f.js"><link rel="prefetch" href="/assets/js/19.e07767d9.js"><link rel="prefetch" href="/assets/js/20.afe5937f.js"><link rel="prefetch" href="/assets/js/21.57f1e9a4.js"><link rel="prefetch" href="/assets/js/22.d47182ce.js"><link rel="prefetch" href="/assets/js/23.15879838.js"><link rel="prefetch" href="/assets/js/24.ffb8b7f9.js"><link rel="prefetch" href="/assets/js/25.012a574f.js"><link rel="prefetch" href="/assets/js/26.f58c8b89.js"><link rel="prefetch" href="/assets/js/27.49f47940.js"><link rel="prefetch" href="/assets/js/28.8dabc266.js"><link rel="prefetch" href="/assets/js/29.8665c708.js"><link rel="prefetch" href="/assets/js/30.e4dfe482.js"><link rel="prefetch" href="/assets/js/31.aebcb925.js"><link rel="prefetch" href="/assets/js/32.7bc36913.js"><link rel="prefetch" href="/assets/js/33.2689d845.js"><link rel="prefetch" href="/assets/js/34.b1d64517.js"><link rel="prefetch" href="/assets/js/35.67a6e77d.js"><link rel="prefetch" href="/assets/js/36.a1ba6e14.js"><link rel="prefetch" href="/assets/js/37.c54b2cb3.js"><link rel="prefetch" href="/assets/js/38.fa8f5dd2.js"><link rel="prefetch" href="/assets/js/39.42dbae8d.js"><link rel="prefetch" href="/assets/js/40.410ffcb6.js"><link rel="prefetch" href="/assets/js/41.932d4877.js"><link rel="prefetch" href="/assets/js/42.2d8c9052.js"><link rel="prefetch" href="/assets/js/43.5441c765.js"><link rel="prefetch" href="/assets/js/44.ce153559.js"><link rel="prefetch" href="/assets/js/45.b65dbb3a.js"><link rel="prefetch" href="/assets/js/46.66753cd9.js"><link rel="prefetch" href="/assets/js/47.f3529e63.js"><link rel="prefetch" href="/assets/js/48.a15e44ae.js"><link rel="prefetch" href="/assets/js/49.6194ced8.js"><link rel="prefetch" href="/assets/js/50.483dd371.js"><link rel="prefetch" href="/assets/js/51.0dffef05.js"><link rel="prefetch" href="/assets/js/52.f6fd0084.js"><link rel="prefetch" href="/assets/js/53.9c00ddb2.js"><link rel="prefetch" href="/assets/js/54.5fdb69c5.js"><link rel="prefetch" href="/assets/js/55.e4952ceb.js"><link rel="prefetch" href="/assets/js/56.00c601c0.js"><link rel="prefetch" href="/assets/js/57.ba900f92.js"><link rel="prefetch" href="/assets/js/58.f692a0ff.js"><link rel="prefetch" href="/assets/js/59.d75f59bd.js"><link rel="prefetch" href="/assets/js/60.86c6e7be.js"><link rel="prefetch" href="/assets/js/61.29ce4f5d.js"><link rel="prefetch" href="/assets/js/62.fd02cd50.js"><link rel="prefetch" href="/assets/js/63.dd91fad1.js"><link rel="prefetch" href="/assets/js/64.656bc895.js"><link rel="prefetch" href="/assets/js/65.df860e0c.js"><link rel="prefetch" href="/assets/js/66.c9fb4b3e.js"><link rel="prefetch" href="/assets/js/67.11c54b72.js"><link rel="prefetch" href="/assets/js/68.3ebb5456.js"><link rel="prefetch" href="/assets/js/69.38a813aa.js"><link rel="prefetch" href="/assets/js/70.f47218a9.js"><link rel="prefetch" href="/assets/js/71.5544a116.js"><link rel="prefetch" href="/assets/js/72.dfce09c3.js"><link rel="prefetch" href="/assets/js/73.88d01397.js"><link rel="prefetch" href="/assets/js/74.6a6227d4.js"><link rel="prefetch" href="/assets/js/75.9cebf766.js"><link rel="prefetch" href="/assets/js/76.65aea59b.js"><link rel="prefetch" href="/assets/js/77.016ec321.js"><link rel="prefetch" href="/assets/js/78.4c79ed99.js"><link rel="prefetch" href="/assets/js/79.a326cc32.js"><link rel="prefetch" href="/assets/js/80.2c3e6c55.js"><link rel="prefetch" href="/assets/js/81.cd233768.js"><link rel="prefetch" href="/assets/js/82.9de3fa40.js"><link rel="prefetch" href="/assets/js/83.324298cc.js"><link rel="prefetch" href="/assets/js/84.2c5f99b8.js"><link rel="prefetch" href="/assets/js/85.cc558c32.js"><link rel="prefetch" href="/assets/js/86.8f6411d4.js"><link rel="prefetch" href="/assets/js/87.39d4e7e2.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.8832ec7c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.59e31e97.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      CPSC-1517 Student Notes
    </span></a><div class="links"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form><nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">Home</a></div><div class="nav-item"><a href="/logs/" class="nav-link">LOGs</a></div><div class="nav-item"><a href="/csharp/" class="nav-link">C-Sharp</a></div><div class="nav-item"><a href="/html/" class="nav-link">Html</a></div><div class="nav-item"><a href="/razor/" class="nav-link">Razor</a></div><div class="nav-item"><a href="/clientserver/" class="nav-link">Client-Server</a></div><div class="nav-item"><a href="/webforms/" class="nav-link">Webforms</a></div><div class="nav-item"><a href="https://github.com/CPSC-1517/CPSC-1517.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">Home</a></div><div class="nav-item"><a href="/logs/" class="nav-link">LOGs</a></div><div class="nav-item"><a href="/csharp/" class="nav-link">C-Sharp</a></div><div class="nav-item"><a href="/html/" class="nav-link">Html</a></div><div class="nav-item"><a href="/razor/" class="nav-link">Razor</a></div><div class="nav-item"><a href="/clientserver/" class="nav-link">Client-Server</a></div><div class="nav-item"><a href="/webforms/" class="nav-link">Webforms</a></div><div class="nav-item"><a href="https://github.com/CPSC-1517/CPSC-1517.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>EntityFramework: Data Access</span><!----></p><ul class="sidebar-group-items"><li><a href="/Instructor/clientServer/lesson-1-notes.html#entityframework-in-logical-client-server-architecture" class="sidebar-link">EntityFramework in logical Client Server Architecture</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-create-controller-class" class="sidebar-link">Coding: Create Controller class</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-setup" class="sidebar-link">Coding: Setup</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-create-bll-productcontroller-class" class="sidebar-link">Coding: Create BLL ProductController class</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-product-list" class="sidebar-link">Coding: Product_List</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-product-get-int-productid" class="sidebar-link">Coding: Product_Get(int productid)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-classroom-exercise" class="sidebar-link">Coding: Classroom exercise</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-web-page" class="sidebar-link">Coding: Web page</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-required-namespaces-for-the-code-behind" class="sidebar-link">Coding: Required Namespaces for the Code-Behind.</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-error-handling-getinnerexception-exception-ex" class="sidebar-link">Coding: Error Handling GetInnerException(Exception ex)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-fill-drop-down-list" class="sidebar-link">Coding: Fill drop down list</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-classroom-exercise-2" class="sidebar-link">Coding: Classroom exercise</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-clear-event" class="sidebar-link">Coding: Clear Event.</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Instructor/clientServer/lesson-1-notes.html#coding-search-event" class="sidebar-link">Coding: Search event.</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="entityframework-data-access"><a href="#entityframework-data-access" aria-hidden="true" class="header-anchor">#</a> EntityFramework: Data Access</h1><p>When ASP.Net first started, users used ADO.Net to access the database. This required mounts of work, redundant setup work. As time went on, as usual, 3rd party individuals attempted to reduce the amount of work needed to access the database using ADO.Net. One popular library was Enterprise Library. This reduce the redundant tedious work of using ADO.net directly. In about 2008, Microsoft introduce EntityFramework to assist developers with database access. ADO.Net was even further removed from developer (hidden). EntityFramework is a set of classes that manage your database access. One links into EntityFramework via inheriting its DBContext class. Using the <code>DBSet&lt;T&gt;</code> of this context class (where <code>&lt;T&gt;</code> is an entity definition class) and properly annotated entity definition class, database CRUD management has been greatly simplified. <strong>In this course, the entity definition classes will be coded manually by the student so they can get a better understanding of the components needed by EnityFramework. Do not reverse engineer the entities. This will be covered in DMIT2018.</strong></p><p><a href="https://en.wikipedia.org/wiki/Entity_Framework" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Entity_Framework<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="http://www.entityframeworktutorial.net/what-is-entityframework.aspx" target="_blank" rel="noopener noreferrer">http://www.entityframeworktutorial.net/what-is-entityframework.aspx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="entityframework-in-logical-client-server-architecture"><a href="#entityframework-in-logical-client-server-architecture" aria-hidden="true" class="header-anchor">#</a> EntityFramework in logical Client Server Architecture</h2><p>EntityFramework will manage the access of data to and from the database (aqua color). The DAL layer will contain a class which will be referred to as the Context class. This class will inherit DbContext from EntityFramework. The commands to query, add, update and delete records will be coded in the BLL classes using the DAL Context Class. The mapping of the sql tables will be done in the Entity classes of the Entity library. These entity classes will be used by the DAL, BLL and PL layers. These classes are data definitions of the sql tables.</p><p><img src="/assets/img/65a79bacad56128241e52332894cdcf0.65a79bac.png" alt></p><h2 id="coding-create-controller-class"><a href="#coding-create-controller-class" aria-hidden="true" class="header-anchor">#</a> Coding: Create Controller class</h2><p>When creating your controller class, you are creating the interface to your application. When we created the context class, we use an access privilege of <strong>internal</strong>. This restricts the access to the context class to <strong>only</strong> other calls from <strong>within</strong> the same class library. We are using this context class as access to the database. Logically, therefore, we need “entrance” into the class library. This interface (entrance) has a public access. Any user wishing to have access to the database must therefore use the methods within this public interface. The interface is made up of public methods. Controlling the code we place in these methods means the application controls what an outside user can or cannot do.</p><p>Business Logic:</p><p>The controller method can contain complex business rules. These are generally rules that cannot be covered by simply validation (presence, datatype, range, etc.). This logic may required multiple database queries. The Alberta Graduated Driver license is an example. There are several different criteria that must be meet before one moves to the next level.</p><p>Transaction Processing:</p><p>The workflow to complete a process many require multiple accesses to the database. This means using a transaction workflow which at any time could be logically terminated for some reason. Consider a sale. There are several tables that need to be updated: inventory, sale, and saledetail. Also, if the transaction is anything but cash, external calls to verify funds need to be worked into the workflow. Transaction Processing will be covered in DMIT2018.</p><p>Security:</p><p>Security can be done at several levels in your application and the BLL method is prime place. Since all outside users wanting to access your database need to<br>
travel through a public interface, checking logins and roles can be done here. Failure to meet proper security clearance means a simple thrown exception. Security will be covered in DMIT2018.</p><p>When we create the controller, one can place all of the interface into one physical file and class. This would made maintenance hazardless. Use the same logical reasons for separating out multiple classes from one physical file and out of one class to more logical classes that has been in the pass. Each entity will have their own controller in its own physical file.</p><h2 id="coding-setup"><a href="#coding-setup" aria-hidden="true" class="header-anchor">#</a> Coding: Setup</h2><ol><li><p>Create a folder called NorthwindPages for sample pages</p></li><li><p>Download ProductCRUD startup WebPage and extract files into NorthwindPages. Refresh folder.</p></li><li><p>Create a web.sitemap with 3 root nodes (Home, Contact and About) and a drop down menu which will contain the coded samples. Add ProductCRUD to drop down menu.</p></li><li><p>Open site.master and alter menu to use web.sitemap. You can copy the code from BasicASPX sitemaster. Rename menu to ClientServerMenu. Change My Application brand to ASPX Client Server.</p></li><li><p>Run and Test menu. End on ProductCRUD</p></li><li><p>Review contents of form (review of basic aspx controls)</p></li></ol><h2 id="coding-create-bll-productcontroller-class"><a href="#coding-create-bll-productcontroller-class" aria-hidden="true" class="header-anchor">#</a> Coding: Create BLL ProductController class</h2><ol><li><p>Create a class in the BLL folder of your NorthwindSystem project called ProductController.</p></li><li><p>Change the access privilege from the default private to public. Any class without a stated access privilege defaults to private.</p></li><li><p>Add the following namespaces:</p><ol><li>using NorthwindEntities;</li><li>using NorthwindSystem.DAL;</li></ol></li></ol><h2 id="coding-product-list"><a href="#coding-product-list" aria-hidden="true" class="header-anchor">#</a> Coding: Product_List</h2><p>EntityFramework has a couple of queries that need no additional effort from you in grabbing either all the records from a table or a single record via the primary key. All work to the database will go through the context class, therefore, we will need to create an instance of the class. To access the data of a sql table, one uses the <code>DbSet&lt;T&gt;</code> properties associated with that table. In this course we will use the simplest techniques in accessing the database. The return datatype of a query for multiple records is usually IEnumerable. We will cast this to a <code>List&lt;T&gt;</code> to make things easier for us. The work will be wrapped in a transaction using <strong><code>using(){…}</code></strong>.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//a method to return all product records from the database to the calling method</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>Product<span class="token operator">&gt;</span> <span class="token function">Product_List</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//need to connect to the Context class</span>
    <span class="token comment">//this connection will be done in a transaction coding group</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NorthwindContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//via EnityFrame, make a request for all records,</span>
        <span class="token comment">//all attributes from the specified DbSet property</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="coding-product-get-int-productid"><a href="#coding-product-get-int-productid" aria-hidden="true" class="header-anchor">#</a> Coding: Product_Get(int productid)</h2><p>EntityFramework has a method called <strong>Find(datatype)</strong> which can be used to retrieve a record from the associate sql table via the context <code>DbSet&lt;T&gt;</code> property.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token class-name">Product</span> Product_Get <span class="token punctuation">(</span><span class="token keyword">int</span> productid<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//return the record from the database via the DbSet collection</span>
    <span class="token comment">//where the pkey matches the supplied value</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NorthwindContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>productid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="coding-classroom-exercise"><a href="#coding-classroom-exercise" aria-hidden="true" class="header-anchor">#</a> Coding: Classroom exercise</h2><p>Create the SupplierController and CategoryController classes. Add two methods to each class. One method to return all records of the associated sql table and one method to return the sql table record for a supplied primary key value.</p><h2 id="coding-web-page"><a href="#coding-web-page" aria-hidden="true" class="header-anchor">#</a> Coding: Web page</h2><h2 id="coding-required-namespaces-for-the-code-behind"><a href="#coding-required-namespaces-for-the-code-behind" aria-hidden="true" class="header-anchor">#</a> Coding: Required Namespaces for the Code-Behind.</h2><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token preprocessor property">#<span class="token directive keyword">region</span> Additional Namespaces</span>
<span class="token keyword">using</span> NorthwindEntities<span class="token punctuation">;</span>
<span class="token keyword">using</span> NorthwindSystem<span class="token punctuation">.</span>BLL<span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
</code></pre></div><h2 id="coding-error-handling-getinnerexception-exception-ex"><a href="#coding-error-handling-getinnerexception-exception-ex" aria-hidden="true" class="header-anchor">#</a> Coding: Error Handling GetInnerException(Exception ex)</h2><p>Most times when an error is generated, we handle it using Try/Catch. This will display the error and we can determine the problem with our code and fix it. However, there will be times when an error is generated and tells you to view the Inner Exception. This can be annoying. A method has been created for your use to handle Catch exceptions. This method will take in an Exception datatype and drill down until it reaches the lowest error then return it as an Exception. You can then cast to a string and assign the result to your message label on the form.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">try</span>
<span class="token punctuation">{</span>
    <span class="token comment">//place your code here</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Message<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token function">GetInnerException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//use this method to discover the inner most error message.</span>
<span class="token comment">//this routine has been created by the user</span>
<span class="token keyword">protected</span> <span class="token class-name">Exception</span> <span class="token function">GetInnerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//drill down to the inner most exception</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ex<span class="token punctuation">.</span>InnerException <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ex <span class="token operator">=</span> ex<span class="token punctuation">.</span>InnerException<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="coding-fill-drop-down-list"><a href="#coding-fill-drop-down-list" aria-hidden="true" class="header-anchor">#</a> Coding: Fill drop down list</h2><p>The concept of placing data into a drop down list should be well understood by your students by this time. Review the two components: display text (visible)<br>
and value text (hidden and associated). Filling a drop down list control will require making a call to the appropriate controller class and obtaining the table collection (data). This collection will be sourced to the control (.DataSource). The display and value texts will be assigned by entity property name. Lastly, the data will be bound to the control (.DataBind()). Prompts can also be added to the drop down list. Although, not necessary, it is handy to place this code into a method so it can be called from any event handler of the web page.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">BindProductList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//since this method will be making a call off the web page</span>
    <span class="token comment">//to another class/project it needs to be placed</span>
    <span class="token comment">//within user friendly error handling</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//setup a connect to the controller that will provide</span>
        <span class="token comment">//the need interface for the request</span>
        <span class="token class-name">ProductController</span> sysmgr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProductController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//obtain the data from the controller</span>
        List<span class="token operator">&lt;</span>Product<span class="token operator">&gt;</span> info <span class="token operator">=</span> sysmgr<span class="token punctuation">.</span><span class="token function">Product_List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Sort of the collection</span>
        <span class="token comment">//optional</span>
        info<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>ProductName<span class="token punctuation">.</span><span class="token function">CompareTo</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>ProductName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//attach data to the drop down list</span>
        ProductList<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> info<span class="token punctuation">;</span>
        <span class="token comment">//specify the display attribute and value attribute</span>
        ProductList<span class="token punctuation">.</span>DataTextField <span class="token operator">=</span> <span class="token string">&quot;ProductName&quot;</span><span class="token punctuation">;</span>
        ProductList<span class="token punctuation">.</span>DataValueField <span class="token operator">=</span> <span class="token string">&quot;ProductID&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//bind the data to the control</span>
        ProductList<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//optional prompt line</span>
        ProductList<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;select ....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Message<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token function">GetInnerException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="coding-classroom-exercise-2"><a href="#coding-classroom-exercise-2" aria-hidden="true" class="header-anchor">#</a> Coding: Classroom exercise</h2><p>Create the BindSupplierList() and BindCategoryList() classes. The drop down controls are SupplierList and CategoryList.</p><h2 id="coding-clear-event"><a href="#coding-clear-event" aria-hidden="true" class="header-anchor">#</a> Coding: Clear Event.</h2><p>Implement the Clear event. Double click the clear linkbutton on the Design view.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">Clear_Click</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ProductID<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    ProductName<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    SupplierList<span class="token punctuation">.</span>SelectedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    CategoryList<span class="token punctuation">.</span>SelectedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    QuantityPerUnit<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    UnitPrice<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    UnitsInStock<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    UnitsOnOrder<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    ReorderLevel<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    Discontinued<span class="token punctuation">.</span>Checked <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="coding-search-event"><a href="#coding-search-event" aria-hidden="true" class="header-anchor">#</a> Coding: Search event.</h2><p>Implement the Search event. Double click the clear linkbutton on the Design view.</p><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">Search_Click</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//verify a product was selected for lookup</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ProductList<span class="token punctuation">.</span>SelectedIndex <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Message<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;Please select a product for the search&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//connect to the required controller</span>
            <span class="token class-name">ProductController</span> sysmgr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProductController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//create a pointer for the data being returned</span>
            <span class="token class-name">Product</span> info <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token comment">//make your call</span>
            info <span class="token operator">=</span> sysmgr<span class="token punctuation">.</span><span class="token function">Product_Get</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>ProductList<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//did you actually get data</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>info <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Message<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;Product not found. Make another selection.&quot;</span><span class="token punctuation">;</span>
                <span class="token function">BindProductList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//load the web controls with the data in my data instance</span>
                ProductID<span class="token punctuation">.</span>Text <span class="token operator">=</span> info<span class="token punctuation">.</span>ProductID<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ProductName<span class="token punctuation">.</span>Text <span class="token operator">=</span> info<span class="token punctuation">.</span>ProductName<span class="token punctuation">;</span>
                SupplierList<span class="token punctuation">.</span>SelectedValue <span class="token operator">=</span> info<span class="token punctuation">.</span>SuppierID<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                CategoryList<span class="token punctuation">.</span>SelectedValue <span class="token operator">=</span> info<span class="token punctuation">.</span>CategoryID<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                QuantityPerUnit<span class="token punctuation">.</span>Text <span class="token operator">=</span> info<span class="token punctuation">.</span>QuantityPerUnit<span class="token punctuation">;</span>
                UnitPrice<span class="token punctuation">.</span>Text <span class="token operator">=</span> info<span class="token punctuation">.</span>UnitPrice <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">&quot;0.00&quot;</span> <span class="token punctuation">:</span>  
                    <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot;{0:0.00}&quot;</span><span class="token punctuation">,</span> info<span class="token punctuation">.</span>UnitPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
                UnitsInStock<span class="token punctuation">.</span>Text <span class="token operator">=</span> info<span class="token punctuation">.</span>UnitsInStock <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">:</span>  
                    info<span class="token punctuation">.</span>UnitsInStock<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                UnitsOnOrder<span class="token punctuation">.</span>Text <span class="token operator">=</span> info<span class="token punctuation">.</span>UnitsOnOrder <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">:</span>  
                    info<span class="token punctuation">.</span>UnitsOnOrder<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ReorderLevel<span class="token punctuation">.</span>Text <span class="token operator">=</span> info<span class="token punctuation">.</span>ReorderLevel <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">:</span>  
                    info<span class="token punctuation">.</span>ReorderLevel<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Discontinued<span class="token punctuation">.</span>Checked <span class="token operator">=</span> info<span class="token punctuation">.</span>Discontinued<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Message<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token function">GetInnerException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/assets/js/3.7e9ccf95.js" defer></script><script src="/assets/js/app.6954d993.js" defer></script>
  </body>
</html>
